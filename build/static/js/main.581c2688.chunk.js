/*! For license information please see main.581c2688.chunk.js.LICENSE.txt */
(this.webpackJsonpmovieweb=this.webpackJsonpmovieweb||[]).push([[0],{101:function(e,t,a){!function(){"use strict";var e=null;e="undefined"===typeof window.videojs?a(31):window.videojs,function(e,t){var a,n={},s={},i={};function l(e,t,a,n){return s={label:a,sources:t},"function"===typeof n?n(e,t,a):e.src(t.map((function(e){return{src:e.src,type:e.type,res:e.res}})))}var r=t.getComponent("MenuItem"),c=t.extend(r,{constructor:function(e,t,a,n){this.onClickListener=a,this.label=n,r.call(this,e,t),this.src=t.src,this.on("click",this.onClick),this.on("touchstart",this.onClick),t.initialySelected&&(this.showAsLabel(),this.selected(!0),this.addClass("vjs-selected"))},showAsLabel:function(){this.label&&(this.label.innerHTML=this.options_.label)},onClick:function(e){this.onClickListener(this);var t=this.player_.currentTime(),a=this.player_.paused();this.showAsLabel(),this.addClass("vjs-selected"),a||this.player_.bigPlayButton.hide(),"function"!==typeof e&&"function"===typeof this.options_.customSourcePicker&&(e=this.options_.customSourcePicker);var n="loadeddata";"Youtube"!==this.player_.techName_&&"none"===this.player_.preload()&&"Flash"!==this.player_.techName_&&(n="timeupdate"),l(this.player_,this.src,this.options_.label,e).one(n,(function(){this.player_.currentTime(t),this.player_.handleTechSeeked_(),a||this.player_.play().handleTechSeeked_(),this.player_.trigger("resolutionchange")}))}}),o=t.getComponent("MenuButton"),u=t.extend(o,{constructor:function(e,a,n,s){if(this.sources=a.sources,this.label=s,this.label.innerHTML=a.initialySelectedLabel,o.call(this,e,a,n),this.controlText("Quality"),n.dynamicLabel)this.el().appendChild(s);else{var i=document.createElement("span");t.addClass(i,"vjs-resolution-button-staticlabel"),this.el().appendChild(i)}},createItems:function(){var e=[],t=this.sources&&this.sources.label||{},a=function(t){e.map((function(e){e.selected(e===t),e.removeClass("vjs-selected")}))};for(var n in t)t.hasOwnProperty(n)&&(e.push(new c(this.player_,{label:n,src:t[n],initialySelected:n===this.options_.initialySelectedLabel,customSourcePicker:this.options_.customSourcePicker},a,this.label)),i[n]=e[e.length-1]);return e}});a=function(e){var a=t.mergeOptions(n,e),r=this,c=document.createElement("span"),o={};function h(e,t){return e.res&&t.res?+t.res-+e.res:0}function d(e){var t={label:{},res:{},type:{}};return e.map((function(e){m(t,"label",e),m(t,"res",e),m(t,"type",e),p(t,"label",e),p(t,"res",e),p(t,"type",e)})),t}function m(e,t,a){null==e[t][a[t]]&&(e[t][a[t]]=[])}function p(e,t,a){e[t][a[t]].push(a)}function v(e){var n=e.tech_.hls;n&&(e.on("mediachange",(function(){e.trigger("resolutionchange")})),e.one("loadedmetadata",(function(){var s=n.playlists.master.playlists,i=[{src:"auto",type:"application/x-mpegURL",label:"auto",res:"auto"}];s.map((function(e){i.push({src:e.uri,type:"application/x-mpegURL",label:e.attributes.NAME||e.attributes.RESOLUTION.height,res:e.attributes.RESOLUTION.height})})),o=d(i);var l=n.playlists.media(),r={label:"auto",res:l.attributes.RESOLUTION.height,sources:l},h=new u(e,{sources:o,initialySelectedLabel:r.label,initialySelectedRes:r.res,customSourcePicker:function(a,s,i){var l,r=s[0].res;return n.selectPlaylist="auto"===(l=r)?t.HlsHandler.prototype.selectPlaylist:function(){return n.playlists.master.playlists.filter((function(e){return e.attributes.RESOLUTION.height===l}))[0]},e}},a,c);h.el().classList.add("vjs-resolution-button"),e.controlBar.resolutionSwitcher=e.controlBar.addChild(h)})))}t.addClass(c,"vjs-resolution-button-label"),r.updateSrc=function(e,n){if(!e)return r.src();if(r.controlBar.resolutionSwitcher&&(r.controlBar.resolutionSwitcher.dispose(),delete r.controlBar.resolutionSwitcher),n&&n.hls)return r.src(e),v(r);e=e.sort(h);var s=function(e,t){var n=a.default,s="";"high"===n?(n=t[0].res,s=t[0].label):"low"!==n&&null!=n&&e.res[n]?e.res[n]&&(s=e.res[n][0].label):(n=t[t.length-1].res,s=t[t.length-1].label);return{res:n,label:s,sources:e.res[n]}}(o=d(e),e),i=new u(r,{sources:o,initialySelectedLabel:s.label,initialySelectedRes:s.res,customSourcePicker:a.customSourcePicker},a,c);return t.addClass(i.el(),"vjs-resolution-button"),r.controlBar.resolutionSwitcher=r.controlBar.el_.insertBefore(i.el_,r.controlBar.getChild("fullscreenToggle").el_),r.controlBar.resolutionSwitcher.dispose=function(){this.parentNode.removeChild(this)},l(r,s.sources,s.label)},r.currentResolution=function(e,t){return null==e?s:(null!=i[e]&&i[e].onClick(t),r)},r.getGroupedSrc=function(){return o},r.ready((function(){r.options_.sources.length>1&&r.updateSrc(r.options_.sources),r.tech_.hls&&r.options_.sources.length&&v(r),"Youtube"===r.techName_&&function(e){e.tech_.ytPlayer.setPlaybackQuality("default"),e.tech_.ytPlayer.addEventListener("onPlaybackQualityChange",(function(){e.trigger("resolutionchange")})),e.one("play",(function(){var t=e.tech_.ytPlayer.getAvailableQualityLevels(),n={highres:{res:1080,label:"1080",yt:"highres"},hd1080:{res:1080,label:"1080",yt:"hd1080"},hd720:{res:720,label:"720",yt:"hd720"},large:{res:480,label:"480",yt:"large"},medium:{res:360,label:"360",yt:"medium"},small:{res:240,label:"240",yt:"small"},tiny:{res:144,label:"144",yt:"tiny"},auto:{res:0,label:"auto",yt:"default"}},s=[];t.map((function(t){s.push({src:e.src().src,type:e.src().type,label:n[t].label,res:n[t].res,_yt:n[t].yt})}));var i="auto",l=0,r=((o=d(s)).label.auto,new u(e,{sources:o,initialySelectedLabel:i,initialySelectedRes:l,customSourcePicker:function(t,a,n){return e.tech_.ytPlayer.setPlaybackQuality(a[0]._yt),e}},a,c));r.el().classList.add("vjs-resolution-button"),e.controlBar.resolutionSwitcher=e.controlBar.addChild(r)}))}(r)}))},t.plugin("videoJsResolutionSwitcher",a)}(window,e)}()},153:function(e,t,a){"use strict";a.r(t);var n=a(1),s=a.n(n),i=a(72),l=a.n(i),r=(a(82),a(83),a(84),a(8)),c=a(9),o=a(11),u=a(10),h=a(14),d=a(12),m=a(17),p=function(e){function t(e){return Object(r.a)(this,t),Object(o.a)(this,Object(u.a)(t).call(this,e))}return Object(d.a)(t,e),Object(c.a)(t,[{key:"render",value:function(){return console.log(this.props),s.a.createElement("div",{class:"card mb-4",style:{width:"18rem"}},s.a.createElement("img",{class:"card-img-top",src:"https://upload.wikimedia.org/wikipedia/commons/thumb/a/ac/No_image_available.svg/1024px-No_image_available.svg.png",alt:"Card image cap"}),s.a.createElement("div",{class:"card-body"},s.a.createElement("h5",{class:"card-title"},this.props.title),s.a.createElement("h6",{class:"card-title"},this.props.title_vietnamese),s.a.createElement(m.b,{to:{pathname:"/movie",movieId:this.props._id},className:"btn btn-primary"},"Watch")))}}]),t}(s.a.Component),v=function(e){function t(e){var a;return Object(r.a)(this,t),(a=Object(o.a)(this,Object(u.a)(t).call(this,e))).state={},a}return Object(d.a)(t,e),Object(c.a)(t,[{key:"componentDidMount",value:function(){}},{key:"render",value:function(){var e=this,t=Object.keys(this.props.movies).map((function(t){return s.a.createElement("div",{key:t,className:"col-md-4"},s.a.createElement(p,Object.assign({key:t},e.props.movies[t])))}));return s.a.createElement("div",null,s.a.createElement("div",{class:"card-deck"},s.a.createElement("div",{className:"row"},t)))}}]),t}(s.a.Component),b=function(e){function t(e){var a;return Object(r.a)(this,t),(a=Object(o.a)(this,Object(u.a)(t).call(this,e))).handleChange=a.handleChange.bind(Object(h.a)(a)),a.processTextDelay=null,a.processText=a.processText.bind(Object(h.a)(a)),a.state={movies:{}},a}return Object(d.a)(t,e),Object(c.a)(t,[{key:"handleChange",value:function(e){var t=this;clearTimeout(this.processTextDelay);var a=e.target.value;this.processTextDelay=setTimeout((function(){t.processText(a)}),500)}},{key:"processText",value:function(e){var t=this;""==e&&this.setState({movies:{}}),fetch("/api/movie/search?title="+e).then((function(e){return e.json()})).then((function(e){if(e.status){t.setState({movies:e.response})}})).catch((function(e){return console.log(e)}))}},{key:"render",value:function(){return s.a.createElement("div",{class:"container"},s.a.createElement("div",{className:"active-cyan-3 active-cyan-4 mb-4"},s.a.createElement("input",{className:"form-control",type:"text",placeholder:"Search","aria-label":"Search",onChange:this.handleChange})),s.a.createElement(v,{movies:this.state.movies}))}}]),t}(s.a.Component),f=a(31);function y(e){var t=[];return e.forEach((function(e){if(e.src&&e.type){var a=e.src,n=e.type.includes("mp4")?"video/mp4":e.type.includes("hls")?"application/x-mpegURL":null,s=e.label?e.label:"MOV";a&&n&&s&&(console.log("here"),t.push({src:a,type:n,label:s}))}})),t}var g=function(e){function t(e){return Object(r.a)(this,t),Object(o.a)(this,Object(u.a)(t).call(this,e))}return Object(d.a)(t,e),Object(c.a)(t,[{key:"render",value:function(){return s.a.createElement("div",null,s.a.createElement("iframe",{src:this.props.iframeSrc,scrolling:"no",frameborder:"0",width:"100%",height:"100%",allowfullscreen:"true",webkitallowfullscreen:"true",mozallowfullscreen:"true"}))}}]),t}(s.a.Component),S=function(e){function t(e){var a;return Object(r.a)(this,t),(a=Object(o.a)(this,Object(u.a)(t).call(this,e))).updatePlayer=a.updatePlayer.bind(Object(h.a)(a)),a}return Object(d.a)(t,e),Object(c.a)(t,[{key:"shouldComponentUpdate",value:function(e,t){return this.updatePlayer(e.movieSrcs),!!(e.movieSrcs&&e.movieSrcs.length>0&&"iframe"==e.movieSrcs[0].type&&"iframe"!=this.props.movieSrcs)}},{key:"updatePlayer",value:function(e){var t=this;console.log(e),null!=e&&(this.player&&this.player.src({}),this.player?e.length&&("application/x-mpegURL"==e[0].type?this.player.updateSrc(e,{hls:!0}):this.player.updateSrc(e)):this.player=Object(f.default)(this.videoNode,{controls:!0,muted:!0,width:1e3,plugins:{videoJsResolutionSwitcher:{ui:!0,default:"low",dynamicLabel:!0}}},(function(){console.log("onPlayerReady",t);var a=t.player;e.length&&("application/x-mpegURL"==e[0].type?a.updateSrc(e,{hls:!0}):a.updateSrc(e))})))}},{key:"componentDidMount",value:function(){window&&(window.videojs=f.default),a(101),a(102),this.updatePlayer(this.props.movieSrcs)}},{key:"render",value:function(){var e=this;return s.a.createElement("div",{"data-vjs-player":!0},s.a.createElement("video",{ref:function(t){return e.videoNode=t},className:"video-js"}))}}]),t}(s.a.Component),E=function(e){function t(e){var a;return Object(r.a)(this,t),(a=Object(o.a)(this,Object(u.a)(t).call(this,e))).state={movieId:null,movieInfo:{},instances:{},selection:null,episodeSelection:0,mediaCache:{},serverSelection:null,movieSrcs:[],loading:{origins:!1,episodes:!1,servers:!1,player:!1}},a.selectEpisode=a.selectEpisode.bind(Object(h.a)(a)),a.selectOrigin=a.selectOrigin.bind(Object(h.a)(a)),a.selectServer=a.selectServer.bind(Object(h.a)(a)),a.mediaCache={},a}return Object(d.a)(t,e),Object(c.a)(t,[{key:"componentDidMount",value:function(){var e=this;console.log("here");var t=null;this.props.location&&(t=this.props.location.movieId,this.setState({movieId:t}),this.setState({loading:{origins:!0,episodes:!0}}),fetch("/api/movie/info?movieId="+t).then((function(e){return e.json()})).then((function(t){t.status&&e.setState({movieInfo:t.response})})).catch((function(e){return console.log(e)})),fetch("/api/movie/episodes?movieId="+t).then((function(e){return e.json()})).then((function(t){if(t.status){var a=t.response;Object.keys(a).length>0&&(e.setState({selection:Object.keys(a).sort()[0],instances:a,loading:{origins:!1,episodes:!1}}),e.selectOrigin(Object.keys(a).sort()[0]))}})).catch((function(e){return console.log(e)})))}},{key:"selectOrigin",value:function(e){e in this.state.instances&&(this.setState({selection:e,movieSrcs:[]}),this.selectEpisode(e,this.state.episodeSelection))}},{key:"selectEpisode",value:function(e,t){var a=this;e in this.state.instances&&(this.setState({loading:{servers:!0}}),this.setState({episodeSelection:parseInt(t),selection:e,movieSrcs:[]}),this.mediaCache[e]&&this.mediaCache[e][t]?(this.setState({loading:{servers:!1}}),this.selectServer(e,t,Object.keys(this.mediaCache[e][t])[0])):fetch("/api/movie/getEpisodeMedia?instanceId=".concat(e,"&ep=").concat(t)).then((function(e){return e.json()})).then((function(n){if(n.status){var s=n.response.sources.direct,i=n.response.mirrors,l=n.response.sources.iframe;a.mediaCache[e]||(a.mediaCache[e]={}),a.mediaCache[e][t]||(a.mediaCache[e][t]={}),s.forEach((function(n){var s=y(n);if(console.log(n),s.length>0){var i="SV#"+Object.keys(a.mediaCache[e][t]).length;a.mediaCache[e][t][i]=s}})),Object.keys(i).forEach((function(n){var s=y(i[n]);if(s.length>0){var l="Mirror#"+Object.keys(a.mediaCache[e][t]).length;a.mediaCache[e][t][l]=s}})),l.forEach((function(n){var s=n;if(s.length>0){var i="IFRAME#"+Object.keys(a.mediaCache[e][t]).length;a.mediaCache[e][t][i]=s}})),console.log(a.state),a.setState({loading:{episodes:!1}}),a.selectServer(e,t,Object.keys(a.mediaCache[e][t])[0]),a.setState({loading:{servers:!1}})}})))}},{key:"selectServer",value:function(e,t,a){a in this.mediaCache[e][t]&&this.setState({serverSelection:a,movieSrcs:this.mediaCache[e][t][a]})}},{key:"render",value:function(){var e=this,t=[],a=[],n=[];if(Object.keys(this.state.instances).length>0){var i=Object.keys(this.state.instances).map((function(t){return[e.state.instances[t].origin,t]})).sort(),l=this.state.selection?this.state.selection:Object.keys(this.state.instances).sort()[0],r=this.state.instances[l].origin;if(t=i.map((function(t){return s.a.createElement("li",{key:t[1],className:"nav-item"},s.a.createElement("button",{key:t[1],className:"nav-link "+(r==t[0]?"active":""),onClick:e.selectOrigin.bind(e,t[1])},t[0]))})),a=this.state.instances[l].episodes.map((function(t,a){return s.a.createElement("li",{key:l+"_"+a,className:"nav-item"},s.a.createElement("button",{key:l+"_"+a,className:"nav-link "+(a==e.state.episodeSelection?"active":""),onClick:e.selectEpisode.bind(e,l,a)},t))})),console.log(this.mediaCache[l]),this.mediaCache[l]&&this.mediaCache[l][this.state.episodeSelection]){var c=this.mediaCache[l][this.state.episodeSelection],o=this.state.serverSelection?this.state.serverSelection:Object.keys(this.mediaCache[l][this.state.episodeSelection])[0];n=Object.keys(c).map((function(t){return s.a.createElement("li",{key:l+"_"+e.state.episodeSelection+"_"+t,className:"nav-item"},s.a.createElement("button",{key:l+"_"+e.state.episodeSelection+"_"+t,className:"nav-link "+(t==o?"active":""),onClick:e.selectServer.bind(e,l,e.state.episodeSelection,t)},t))}))}}return s.a.createElement("div",{className:"container"},s.a.createElement("h3",null,this.state.movieInfo.title?this.state.movieInfo.title:"Loading..."),this.state.movieSrcs.length>0&&"iframe"!=this.state.movieSrcs[0].type?s.a.createElement(S,{movieSrcs:this.state.movieSrcs}):s.a.createElement(g,{iframeSrc:this.state.movieSrcs.length?this.state.movieSrcs[0].src:""}),this.state.loading.player?s.a.createElement("img",{src:"./loading.gif"}):null,s.a.createElement("div",{className:"card",style:{textAlign:"left"}},s.a.createElement("div",{className:"card-header"},s.a.createElement("ul",{className:"nav nav-pills card-header-pills"},t,this.state.loading.origins?s.a.createElement("img",{src:"./loading.gif"}):null)),s.a.createElement("div",{className:"card-body"},s.a.createElement("ul",{className:"nav nav-pills"},a,this.state.loading.episodes?s.a.createElement("img",{src:"./loading.gif"}):null),s.a.createElement("div",{className:"card-body"},s.a.createElement("h6",null,"Servers"),s.a.createElement("ul",{className:"nav nav-pills"},n,this.state.loading.servers?s.a.createElement("img",{src:"./loading.gif"}):null)))))}}]),t}(s.a.Component),k=function(e){function t(e){return Object(r.a)(this,t),Object(o.a)(this,Object(u.a)(t).call(this,e))}return Object(d.a)(t,e),Object(c.a)(t,[{key:"componentDidMount",value:function(){}},{key:"render",value:function(){return s.a.createElement("nav",{className:"navbar navbar-expand-md navbar-dark bg-dark"},s.a.createElement(m.b,{className:"navbar-brand",to:"/"},"TurboFilm"),s.a.createElement("button",{className:"navbar-toggler",type:"button","data-toggle":"collapse","data-target":"#navbarCollapse","aria-controls":"navbarCollapse","aria-expanded":"false","aria-label":"Toggle navigation"},s.a.createElement("span",{className:"navbar-toggler-icon"})),s.a.createElement("div",{className:"collapse navbar-collapse",id:"navbarCollapse"},s.a.createElement("ul",{className:"navbar-nav mr-auto"},s.a.createElement("li",{className:"nav-item active"},s.a.createElement(m.b,{className:"nav-link",to:"/"},"Home ",s.a.createElement("span",{className:"sr-only"},"(current)"))),s.a.createElement("li",{className:"nav-item"},s.a.createElement("a",{className:"nav-link",href:"#"},"Link")))))}}]),t}(s.a.Component),j=a(16);var O=function(){return s.a.createElement(m.a,null,s.a.createElement("div",{className:"App"},s.a.createElement("header",null,s.a.createElement(k,null)),s.a.createElement("div",{className:"container"},s.a.createElement(j.c,null,s.a.createElement(j.a,{path:"/movie",component:E}),s.a.createElement(j.a,{path:"/"},s.a.createElement(b,null))))))};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));l.a.render(s.a.createElement(O,null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)}))},77:function(e,t,a){e.exports=a(153)},82:function(e,t,a){},83:function(e,t,a){e.exports=a.p+"static/media/logo.5d5d9eef.svg"},84:function(e,t,a){},89:function(e,t){}},[[77,1,2]]]);
//# sourceMappingURL=main.581c2688.chunk.js.map